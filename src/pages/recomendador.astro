---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Recomendador de Productos">
  <div class="bg-purple-50 min-h-screen py-12">
    <div class="max-w-4xl mx-auto px-4">
      
      <!-- Header -->
      <div class="text-center mb-10">
        <h1 class="text-4xl font-bold text-gray-800 mb-4">
          Encuentra el Producto Perfecto
        </h1>
        <p class="text-lg text-gray-600">
          Responde unas sencillas preguntas y te recomendaremos los mejores productos para tu mascota
        </p>
      </div>

      <!-- Wizard Container -->
      <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
        
        <!-- Progress Bar -->
        <div class="bg-gray-100 px-6 py-4">
          <div class="flex justify-between items-center mb-2">
            <span class="text-sm font-medium text-gray-600">Progreso</span>
            <span class="text-sm font-medium text-purple-600" id="progress-text">Paso 1 de 4</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div id="progress-bar" class="bg-purple-600 h-2 rounded-full transition-all duration-500" style="width: 25%"></div>
          </div>
        </div>

        <!-- Steps Content -->
        <div class="p-8">
          
          <!-- Step 1: Tipo de Mascota -->
          <div id="step-1" class="step-content">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
              ¿Qué tipo de mascota tienes?
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <button class="pet-type-btn group p-8 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all" data-value="perro">
                <svg class="w-16 h-16 mx-auto mb-4 text-gray-600 group-hover:text-purple-600 group-hover:scale-110 transition-all" fill="currentColor" viewBox="0 0 24 24"><path d="M18 4c-1 0-2 .5-3 1-.5-1-1.5-2-3-2s-2.5 1-3 2c-1-.5-2-1-3-1-2.5 0-4 2-4 4 0 1.5.5 3 2 4v7c0 .5.5 1 1 1h2c.5 0 1-.5 1-1v-2h8v2c0 .5.5 1 1 1h2c.5 0 1-.5 1-1v-7c1.5-1 2-2.5 2-4 0-2-1.5-4-4-4z"/></svg>
                <p class="text-lg font-semibold text-gray-800">Perro</p>
              </button>
              <button class="pet-type-btn group p-8 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all" data-value="gato">
                <svg class="w-16 h-16 mx-auto mb-4 text-gray-600 group-hover:text-purple-600 group-hover:scale-110 transition-all" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C9 2 7 4 7 7v1.5C5.5 9 4 10.5 4 12.5c0 1.5.5 3 2 4v5.5c0 .5.5 1 1 1h2c.5 0 1-.5 1-1V20h4v2c0 .5.5 1 1 1h2c.5 0 1-.5 1-1v-5.5c1.5-1 2-2.5 2-4 0-2-1.5-3.5-3-4V7c0-3-2-5-5-5z"/></svg>
                <p class="text-lg font-semibold text-gray-800">Gato</p>
              </button>
              <button class="pet-type-btn group p-8 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all" data-value="otros">
                <svg class="w-16 h-16 mx-auto mb-4 text-gray-600 group-hover:text-purple-600 group-hover:scale-110 transition-all" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3c-1.5 0-3 .5-4 1.5C7 3.5 5.5 3 4 3c-1 0-2 .5-2.5 1.5-.5.5-.5 1.5 0 2.5.5.5 1 1 2 1 0 1.5 1 3 2.5 4v8c0 .5.5 1 1 1h10c.5 0 1-.5 1-1v-8c1.5-1 2.5-2.5 2.5-4 1 0 1.5-.5 2-1 .5-1 .5-2 0-2.5C22 3.5 21 3 20 3c-1.5 0-3 .5-4 1.5-1-1-2.5-1.5-4-1.5z"/></svg>
                <p class="text-lg font-semibold text-gray-800">Otros</p>
              </button>
            </div>
          </div>

          <!-- Step 2: Edad -->
          <div id="step-2" class="step-content hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
              ¿Qué edad tiene tu mascota?
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <button class="age-btn group p-8 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all" data-value="cachorro">
                <svg class="w-16 h-16 mx-auto mb-4 text-gray-600 group-hover:text-purple-600 group-hover:scale-110 transition-all" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3C7.5 3 4 6.5 4 11c0 2 .5 3.5 1.5 5-.5 1-1 2-1 3 0 1.5 1 3 2.5 3 1 0 2-.5 2.5-1.5.5.5 1.5.5 2.5.5s2 0 2.5-.5c.5 1 1.5 1.5 2.5 1.5 1.5 0 2.5-1.5 2.5-3 0-1-.5-2-1-3 1-1.5 1.5-3 1.5-5 0-4.5-3.5-8-8-8z"/></svg>
                <p class="text-lg font-semibold text-gray-800">Cachorro</p>
                <p class="text-sm text-gray-500">0-12 meses</p>
              </button>
              <button class="age-btn group p-8 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all" data-value="adulto">
                <svg class="w-16 h-16 mx-auto mb-4 text-gray-600 group-hover:text-purple-600 group-hover:scale-110 transition-all" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm-1 15v-4H8l4-7v4h3l-4 7z"/></svg>
                <p class="text-lg font-semibold text-gray-800">Adulto</p>
                <p class="text-sm text-gray-500">1-7 años</p>
              </button>
              <button class="age-btn group p-8 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all" data-value="senior">
                <svg class="w-16 h-16 mx-auto mb-4 text-gray-600 group-hover:text-purple-600 group-hover:scale-110 transition-all" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.5 0-8-3.5-8-8s3.5-8 8-8 8 3.5 8 8-3.5 8-8 8zm1-13h-2v6l5 3 1-1.5-4-2.5V7z"/></svg>
                <p class="text-lg font-semibold text-gray-800">Senior</p>
                <p class="text-sm text-gray-500">+7 años</p>
              </button>
            </div>
          </div>

          <!-- Step 3: Tamaño (solo para perros) -->
          <div id="step-3" class="step-content hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
              ¿De qué tamaño es tu mascota?
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <button class="size-btn group p-8 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all" data-value="mini">
                <svg class="w-10 h-10 mx-auto mb-4 text-gray-600 group-hover:text-purple-600 group-hover:scale-110 transition-all" fill="currentColor" viewBox="0 0 24 24"><path d="M18 4c-1 0-2 .5-3 1-.5-1-1.5-2-3-2s-2.5 1-3 2c-1-.5-2-1-3-1-2.5 0-4 2-4 4 0 1.5.5 3 2 4v7c0 .5.5 1 1 1h2c.5 0 1-.5 1-1v-2h8v2c0 .5.5 1 1 1h2c.5 0 1-.5 1-1v-7c1.5-1 2-2.5 2-4 0-2-1.5-4-4-4z"/></svg>
                <p class="text-lg font-semibold text-gray-800">Pequeño</p>
                <p class="text-sm text-gray-500">&lt;10 kg</p>
              </button>
              <button class="size-btn group p-8 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all" data-value="mediano">
                <svg class="w-14 h-14 mx-auto mb-4 text-gray-600 group-hover:text-purple-600 group-hover:scale-110 transition-all" fill="currentColor" viewBox="0 0 24 24"><path d="M18 4c-1 0-2 .5-3 1-.5-1-1.5-2-3-2s-2.5 1-3 2c-1-.5-2-1-3-1-2.5 0-4 2-4 4 0 1.5.5 3 2 4v7c0 .5.5 1 1 1h2c.5 0 1-.5 1-1v-2h8v2c0 .5.5 1 1 1h2c.5 0 1-.5 1-1v-7c1.5-1 2-2.5 2-4 0-2-1.5-4-4-4z"/></svg>
                <p class="text-lg font-semibold text-gray-800">Mediano</p>
                <p class="text-sm text-gray-500">10-25 kg</p>
              </button>
              <button class="size-btn group p-8 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all" data-value="grande">
                <svg class="w-16 h-16 mx-auto mb-4 text-gray-600 group-hover:text-purple-600 group-hover:scale-110 transition-all" fill="currentColor" viewBox="0 0 24 24"><path d="M18 4c-1 0-2 .5-3 1-.5-1-1.5-2-3-2s-2.5 1-3 2c-1-.5-2-1-3-1-2.5 0-4 2-4 4 0 1.5.5 3 2 4v7c0 .5.5 1 1 1h2c.5 0 1-.5 1-1v-2h8v2c0 .5.5 1 1 1h2c.5 0 1-.5 1-1v-7c1.5-1 2-2.5 2-4 0-2-1.5-4-4-4z"/></svg>
                <p class="text-lg font-semibold text-gray-800">Grande</p>
                <p class="text-sm text-gray-500">&gt;25 kg</p>
              </button>
            </div>
          </div>

          <!-- Step 4: Categoría -->
          <div id="step-4" class="step-content hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
              ¿Qué tipo de producto buscas?
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
              <button class="category-btn group p-6 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all" data-value="alimentacion">
                <svg class="w-10 h-10 mx-auto mb-2 text-gray-600 group-hover:text-purple-600 group-hover:scale-110 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                <p class="font-semibold text-gray-800">Alimentación</p>
              </button>
              <button class="category-btn group p-6 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all" data-value="juguetes">
                <svg class="w-10 h-10 mx-auto mb-2 text-gray-600 group-hover:text-purple-600 group-hover:scale-110 transition-all" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/></svg>
                <p class="font-semibold text-gray-800">Juguetes</p>
              </button>
              <button class="category-btn group p-6 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all" data-value="higiene">
                <svg class="w-10 h-10 mx-auto mb-2 text-gray-600 group-hover:text-purple-600 group-hover:scale-110 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                <p class="font-semibold text-gray-800">Higiene</p>
              </button>
              <button class="category-btn group p-6 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all" data-value="salud">
                <svg class="w-10 h-10 mx-auto mb-2 text-gray-600 group-hover:text-purple-600 group-hover:scale-110 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                <p class="font-semibold text-gray-800">Salud</p>
              </button>
              <button class="category-btn group p-6 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all" data-value="accesorios">
                <svg class="w-10 h-10 mx-auto mb-2 text-gray-600 group-hover:text-purple-600 group-hover:scale-110 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                <p class="font-semibold text-gray-800">Accesorios</p>
              </button>
              <button class="category-btn group p-6 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all" data-value="">
                <svg class="w-10 h-10 mx-auto mb-2 text-gray-600 group-hover:text-purple-600 group-hover:scale-110 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg>
                <p class="font-semibold text-gray-800">Todo</p>
              </button>
            </div>
          </div>

          <!-- Loading -->
          <div id="loading-results" class="step-content hidden text-center py-12">
            <svg class="w-16 h-16 mx-auto mb-6 text-purple-600 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Buscando productos perfectos...</h2>
            <p class="text-gray-600">Analizando las mejores opciones para tu mascota</p>
          </div>

          <!-- Results -->
          <div id="step-results" class="step-content hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
              ¡Productos Recomendados!
            </h2>
            <div id="results-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <!-- Se llenan dinámicamente -->
            </div>
            <div class="text-center mt-8">
              <button id="restart-btn" class="px-6 py-3 border-2 border-gray-300 text-gray-700 font-bold rounded-xl hover:border-purple-500 hover:text-purple-600 transition-colors">
                Empezar de nuevo
              </button>
            </div>
          </div>
        </div>

        <!-- Navigation -->
        <div class="bg-gray-50 px-8 py-4 flex justify-between" id="nav-buttons">
          <button id="back-btn" class="hidden px-6 py-3 text-gray-600 font-medium hover:text-gray-800 transition-colors flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Atrás
          </button>
          <div></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    import { supabase } from '../lib/supabase';

    // Estado del wizard
    let currentStep = 1;
    const totalSteps = 4;
    const selections: Record<string, string> = {
      animal_type: '',
      age_range: '',
      size: '',
      category: ''
    };

    // Elementos
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const backBtn = document.getElementById('back-btn');
    const navButtons = document.getElementById('nav-buttons');

    // Función para mostrar un paso
    function showStep(step: number) {
      document.querySelectorAll('.step-content').forEach(el => el.classList.add('hidden'));
      const stepEl = document.getElementById(`step-${step}`);
      if (stepEl) {
        stepEl.classList.remove('hidden');
      }
      
      // Actualizar progreso
      const progress = (step / totalSteps) * 100;
      if (progressBar) progressBar.style.width = `${progress}%`;
      if (progressText) progressText.textContent = `Paso ${step} de ${totalSteps}`;
      
      // Mostrar/ocultar botón atrás
      if (step > 1 && step <= totalSteps) {
        backBtn?.classList.remove('hidden');
      } else {
        backBtn?.classList.add('hidden');
      }
    }

    // Función para ir al siguiente paso
    function nextStep(selection: string, value: string) {
      selections[selection] = value;
      
      // Marcar selección visualmente
      const buttons = document.querySelectorAll(`[data-value="${value}"]`);
      buttons.forEach(btn => {
        btn.classList.add('border-purple-500', 'bg-purple-50');
      });

      // Si es perro, mostrar tamaño. Si no, saltar al paso de categoría
      if (currentStep === 1 && value !== 'perro') {
        currentStep = 3; // Saltamos el paso de tamaño
      } else {
        currentStep++;
      }

      if (currentStep > totalSteps) {
        showResults();
      } else {
        showStep(currentStep);
      }
    }

    // Función para retroceder
    function prevStep() {
      if (currentStep > 1) {
        // Limpiar selección visual del paso actual
        const currentStepEl = document.getElementById(`step-${currentStep}`);
        currentStepEl?.querySelectorAll('[data-value]').forEach(btn => {
          btn.classList.remove('border-purple-500', 'bg-purple-50');
        });

        // Si estamos en categoría y no es perro, volver a edad
        if (currentStep === 4 && selections.animal_type !== 'perro') {
          currentStep = 2;
        } else {
          currentStep--;
        }
        
        showStep(currentStep);
      }
    }

    // Función para mostrar resultados
    async function showResults() {
      // Ocultar navegación
      navButtons?.classList.add('hidden');
      
      // Mostrar loading
      document.querySelectorAll('.step-content').forEach(el => el.classList.add('hidden'));
      document.getElementById('loading-results')?.classList.remove('hidden');

      try {
        // Construir query
        let query = supabase
          .from('products')
          .select('*')
          .eq('animal_type', selections.animal_type);

        if (selections.age_range) {
          query = query.eq('age_range', selections.age_range);
        }

        if (selections.size && selections.animal_type === 'perro') {
          query = query.eq('size', selections.size);
        }

        if (selections.category) {
          query = query.eq('category', selections.category);
        }

        const { data: products, error } = await query.limit(6);

        // Simular carga
        await new Promise(resolve => setTimeout(resolve, 1000));

        // Ocultar loading
        document.getElementById('loading-results')?.classList.add('hidden');
        document.getElementById('step-results')?.classList.remove('hidden');

        const resultsGrid = document.getElementById('results-grid');
        
        if (!products || products.length === 0) {
          resultsGrid!.innerHTML = `
            <div class="col-span-full text-center py-8">
              <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
              <h3 class="text-xl font-bold text-gray-800 mb-2">No encontramos productos</h3>
              <p class="text-gray-600 mb-6">Prueba con otros filtros o explora todo nuestro catálogo</p>
              <a href="/productos" class="inline-block px-6 py-3 bg-purple-700 text-white font-bold rounded-xl hover:bg-purple-800 transition-colors">
                Ver todos los productos
              </a>
            </div>
          `;
        } else {
          resultsGrid!.innerHTML = products.map((product: any) => {
            const imgUrl = product.slug ? `/images/productos/${product.slug}.jpg` : (product.image_url || '');
            const imageHtml = `<img 
                  src="${imgUrl}" 
                  alt="${product.name}"
                  class="w-full h-full object-contain group-hover:scale-105 transition-transform"
                  onerror="this.onerror=null;this.parentElement.innerHTML='<div class=\\'w-full h-full bg-gradient-to-br from-purple-400 to-pink-500 flex items-center justify-center rounded-lg\\'><span class=\\'text-white/80 font-bold text-sm text-center px-3\\'>${product.name.replace(/'/g, "\\'")}</span></div>'"
                />`;
            return `
            <a href="/producto/${product.slug || product.id}" class="block bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition-all group">
              <div class="aspect-square bg-gray-100 p-4">
                ${imageHtml}
              </div>
              <div class="p-4">
                <h3 class="font-semibold text-gray-800 mb-2 line-clamp-2">${product.name}</h3>
                <div class="flex items-baseline gap-2">
                  ${product.on_sale && product.sale_price 
                    ? `<span class="text-xl font-bold text-red-500">${product.sale_price.toFixed(2)}€</span>
                       <span class="text-sm text-gray-400 line-through">${product.price.toFixed(2)}€</span>`
                    : `<span class="text-xl font-bold text-gray-800">${product.price.toFixed(2)}€</span>`
                  }
                </div>
              </div>
            </a>
          `}).join('');
        }

      } catch (error) {
        console.error('Error buscando productos:', error);
        document.getElementById('loading-results')?.classList.add('hidden');
        document.getElementById('step-results')?.classList.remove('hidden');
        document.getElementById('results-grid')!.innerHTML = `
          <div class="col-span-full text-center py-8">
            <svg class="w-16 h-16 mx-auto mb-4 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
            <h3 class="text-xl font-bold text-gray-800 mb-2">Error al buscar productos</h3>
            <p class="text-gray-600">Por favor, inténtalo de nuevo</p>
          </div>
        `;
      }
    }

    // Función para reiniciar
    function restart() {
      currentStep = 1;
      Object.keys(selections).forEach(key => selections[key] = '');
      
      // Limpiar selecciones visuales
      document.querySelectorAll('[data-value]').forEach(btn => {
        btn.classList.remove('border-purple-500', 'bg-purple-50');
      });
      
      navButtons?.classList.remove('hidden');
      showStep(1);
    }

    // Event listeners
    document.querySelectorAll('.pet-type-btn').forEach(btn => {
      btn.addEventListener('click', () => nextStep('animal_type', (btn as HTMLElement).dataset.value!));
    });

    document.querySelectorAll('.age-btn').forEach(btn => {
      btn.addEventListener('click', () => nextStep('age_range', (btn as HTMLElement).dataset.value!));
    });

    document.querySelectorAll('.size-btn').forEach(btn => {
      btn.addEventListener('click', () => nextStep('size', (btn as HTMLElement).dataset.value!));
    });

    document.querySelectorAll('.category-btn').forEach(btn => {
      btn.addEventListener('click', () => nextStep('category', (btn as HTMLElement).dataset.value!));
    });

    backBtn?.addEventListener('click', prevStep);
    document.getElementById('restart-btn')?.addEventListener('click', restart);
  </script>

  <style>
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</Layout>
